
# Fake-Detect νμ΄ν”„λΌμΈ

## π“ ν”„λ΅μ νΈ κ°μ”

**λ©ν‘**  
ν•λ°­λ€ AI κ²½μ§„λ€ν(κ°€μ§ ν…μ¤νΈ νλ³„) κ·μ •μ„ 100% μ¤€μν•λ©΄μ„ A600 GPU(48 GB) ν™κ²½μ—μ„ μ•½ **2μ‹κ°„** λ‚΄μ— `submission.csv`λ¥Ό μƒμ„±ν•λ” μ•™μƒλΈ” νμ΄ν”„λΌμΈμ…λ‹λ‹¤.

**μ‚¬μ© λ¨λΈ λ° κΈ°λ²•**
- Mistral-7B QLoRA: λ€κ·λ¨ μ–Έμ–΄ λ¨λΈμ κ²½λ‰ν™”λ νμΈνλ‹
- DeBERTa-v3-Large LoRA: μ–‘λ°©ν–¥ μΈμ½”λ” λ¨λΈμ κ²½λ‰ν™”λ νμΈνλ‹
- TF-IDF + LightGBM: μ „ν†µμ μΈ ν…μ¤νΈ νΉμ§• μ¶”μ¶κ³Ό κ·Έλλ””μ–ΈνΈ λ¶€μ¤ν…
- 3-gram KenLM: μ–Έμ–΄ λ¨λΈ κΈ°λ° perplexity νΉμ§• μ¶”μ¶
- LogReg μ¤νƒν‚Ή: μ„λ΅ λ‹¤λ¥Έ λ¨λΈμ μ¶λ ¥μ„ κ²°ν•©ν•λ” λ©”νƒ€λ¨λΈ

## π“‚ ν΄λ” κµ¬μ΅° λ° νμΌ μ„¤λ…

```
fake-detect/
β” run.sh                # ν• μ¤„ μ‹¤ν–‰ μ¤ν¬λ¦½νΈ (μ „μ²΄ νμ΄ν”„λΌμΈ)
β” README.md             # ν”„λ΅μ νΈ λ¬Έμ„ν™”
β” config.yaml           # ν•μ΄νΌνλΌλ―Έν„°/κ²½λ΅ μ„¤μ • (μƒλ€κ²½λ΅ μ‚¬μ©)
β” .env                  # (μ„ νƒ) λ―Όκ°μ •λ³΄/μ™Έλ¶€ν‚¤ ν™κ²½λ³€μ νμΌ
β” requirements.txt      # μμ΅΄μ„± ν¨ν‚¤μ§€
β” data/                 # λ°μ΄ν„° λ””λ ‰ν† λ¦¬
β”‚   β” train.csv         # ν•™μµ λ°μ΄ν„° (μ›λ³Έ)
β”‚   β” train_folds.csv   # K-Fold λ¶„ν• λ ν•™μµ λ°μ΄ν„° (μƒμ„±λ¨)
β”‚   β”” test.csv          # ν…μ¤νΈ λ°μ΄ν„°
β” src/                  # νμ΄ν”„λΌμΈ μ½”λ“
β”‚   β” 0_split_folds.py  # K-Fold λ¶„ν•  (μµμ…)
β”‚   β” 1_tfidf_lgbm.py   # TF-IDF + LightGBM ν•™μµ
β”‚   β” 2_build_lm.py     # 3-gram KenLM κµ¬μ¶•
β”‚   β” train_lora.py     # Mistral-7B QLoRA ν•™μµ
β”‚   β” train_deberta.py  # DeBERTa-Large LoRA ν•™μµ
β”‚   β” stack.py          # λ©”νƒ€-LogReg μ¤νƒν‚Ή
β”‚   β” infer.py          # μµμΆ… μ¶”λ΅  λ° submission.csv μƒμ„±
β”‚   β”” utils.py          # κ³µν†µ μ ν‹Έλ¦¬ν‹° ν•¨μ
β”” checkpoint/           # ν•™μµ κ²°κ³Ό μ €μ¥ λ””λ ‰ν† λ¦¬
    β” tfidf.pkl         # TF-IDF λ²΅ν„°λΌμ΄μ €
    β” lgbm.pkl          # LightGBM λ¨λΈ
    β” data3.binary      # KenLM 3-gram λ¨λΈ
    β” mistral.pt        # Mistral μ²΄ν¬ν¬μΈνΈ
    β” deberta.pt        # DeBERTa μ²΄ν¬ν¬μΈνΈ
    β”” meta.pkl          # μ¤νƒν‚Ή λ©”νƒ€λ¨λΈ
```

## π” μ£Όμ” νμΌ μƒμ„Έ μ„¤λ…

### μ„¤μ • λ° λ°μ΄ν„° μ¤€λΉ„
- **config.yaml**: λ¨λ“  ν•μ΄νΌνλΌλ―Έν„°μ™€ κ²½λ΅λ¥Ό μ¤‘μ•™ κ΄€λ¦¬
  - `data_preprocessing`: NULL κ°’ μ²λ¦¬, ν…μ¤νΈ μ •μ , μ¤‘λ³µ μ κ±° μ„¤μ •
  - `logging`: λ΅κ·Έ μ €μ¥, μ§„ν–‰ μƒν™© ν‘μ‹ μ„¤μ •
  - λ¨λΈλ³„ νλΌλ―Έν„°: `mistral`, `deberta`, `tfidf`, `lgbm` μ„Έμ…

- **src/utils.py**: ν”„λ΅μ νΈ μ „μ²΄μ—μ„ μ‚¬μ©λλ” κ³µν†µ μ ν‹Έλ¦¬ν‹°
  - λ΅κ·Έ κ΄€λ¦¬: `init_logging()`, `log()`, `close_logging()`
  - ν…μ¤νΈ μ „μ²λ¦¬: `clean_text()`, `noise_text()`
  - KenLM μ ν‹Έλ¦¬ν‹°: λ¨λ“ κ²€μ‚¬, λ”λ―Έ νμΌ μƒμ„±
  - λ°μ΄ν„° κ²€μ¦: `check_and_clean_data()` - NULL κ°’ μ²λ¦¬
  - μ§„ν–‰ μƒν™© μ¶”μ : `ProgressTracker` ν΄λμ¤
  - Early Stopping: κ³Όμ ν•© λ°©μ§€

- **src/0_split_folds.py**: λ°μ΄ν„° λ¶„ν• 
  - μ›λ³Έ train.csvλ¥Ό K-Foldλ΅ λ¶„ν• ν•μ—¬ train_folds.csv μƒμ„±
  - configμ—μ„ `kfold.enable`κ°€ TrueμΈ κ²½μ°λ§ K-Fold μ μ©

### λ¨λΈ ν•™μµ λ° μ¶”λ΅ 

- **src/1_tfidf_lgbm.py**: ν…μ¤νΈ νΉμ§• μ¶”μ¶ λ° LightGBM λ¨λΈ ν•™μµ
  - TF-IDF λ²΅ν„°ν™”: ν…μ¤νΈλ¥Ό μμΉ νΉμ§•μΌλ΅ λ³€ν™
  - LightGBM λ¨λΈ: κ²½λ‰ κ·Έλλ””μ–ΈνΈ λ¶€μ¤ν…μΌλ΅ λΉ λ¥Έ ν•™μµ
  - λ¨λΈ μ €μ¥: tfidf.pkl, lgbm.pkl μƒμ„±

- **src/2_build_lm.py**: μ–Έμ–΄ λ¨λΈ κµ¬μ¶•
  - KenLM μ„¤μΉ μ—¬λ¶€ κ²€μ‚¬ λ° μ•λ‚΄
  - KenLM λ―Έμ„¤μΉ μ‹ λ”λ―Έ νμΌ μƒμ„± (μ΄ν›„ λ‹¨κ³„ μ§„ν–‰ λ³΄μ¥)
  - μλ„μ°/λ¦¬λ…μ¤ ν™κ²½ μλ™ κ°μ§€ λ° λ…λ Ήμ–΄ μ μ©

- **src/train_lora.py**: Mistral-7B λ¨λΈ ν•™μµ
  - 4λΉ„νΈ μ–‘μν™”λ΅ λ©”λ¨λ¦¬ ν¨μ¨μ  ν•™μµ (QLoRA)
  - λ°μ΄ν„° μ¦κ°•: λ§μ¤ν‚Ή, λ€μ†λ¬Έμ λ³€ν™μΌλ΅ κ°•κ±΄μ„± ν–¥μƒ
  - mistral.pt μ²΄ν¬ν¬μΈνΈ μ €μ¥
  - μ¶”λ΅  ν•¨μ: `probs_model1()` - λ°°μΉ μ²λ¦¬ μµμ ν™”

- **src/train_deberta.py**: DeBERTa-v3-Large λ¨λΈ ν•™μµ
  - LoRA μ–΄λ‘ν„°λ΅ λ§¤κ°λ³€μ ν¨μ¨μ  ν•™μµ
  - 16λΉ„νΈ λ¶€λ™μ†μμ  μ—°μ‚°μΌλ΅ μ†λ„ ν–¥μƒ
  - deberta.pt μ²΄ν¬ν¬μΈνΈ μ €μ¥
  - μ¶”λ΅  ν•¨μ: `probs_model2()` - λ°°μΉ μ²λ¦¬ μµμ ν™”

- **src/stack.py**: μ•™μƒλΈ” λ©”νƒ€λ¨λΈ ν•™μµ
  - 4κ°€μ§€ λ¨λΈ(Mistral, DeBERTa, TF-IDF, KenLM)μ μμΈ΅ κ²°ν•©
  - λ΅μ§€μ¤ν‹± νκ·€λ΅ μµμ  κ°€μ¤‘μΉ ν•™μµ
  - κ²¬κ³ μ„±: μΌλ¶€ λ¨λΈ μ‹¤ν¨ μ‹ λ€μ²΄ λ΅μ§ μ κ³µ
  - meta.pkl λ©”νƒ€λ¨λΈ μ €μ¥

- **src/infer.py**: μµμΆ… μ¶”λ΅  λ° κ²°κ³Ό μƒμ„±
  - ν…μ¤νΈ λ°μ΄ν„° λ΅λ“ λ° μ „μ²λ¦¬
  - λ¨λ“  λ¨λΈ λ΅λ“ λ° μμΈ΅ μν–‰
  - μμΈ΅ κ²°ν•© λ° submission.csv μƒμ„±
  - μ² μ €ν• μμ™Έ μ²λ¦¬λ΅ μ•μ •μ  μ‹¤ν–‰ λ³΄μ¥

## β™οΈ μ£Όμ” κ°μ„ μ‚¬ν•­ λ° νΉμ§•

1. **κ°•ν™”λ λ΅κΉ… μ‹μ¤ν…**
   - λ λ²¨λ³„ λ΅κΉ…(INFO, WARNING, ERROR)
   - λ΅κ·Έ νμΌ λ° μ½μ†” μ¶λ ¥ λ™μ‹ μ§€μ›
   - λ΅κ·Έ νμΌ μ“°κΈ° μ‹¤ν¨ μ‹μ—λ„ μ‹¤ν–‰ κ³„μ†
   - μ§„ν–‰ μƒν™© μ‹¤μ‹κ°„ ν‘μ‹

2. **κ²¬κ³ ν• μμ™Έ μ²λ¦¬**
   - λ¨λ“  ν•µμ‹¬ ν•¨μμ— try-except λΈ”λ΅ 
   - μ¤λ¥ λ°μƒ μ‹ μƒμ„Έ λ΅κΉ… λ° λ€μ²΄ λ™μ‘
   - νΉν KenLM λ¨λ“ μ—†μ„ λ•λ„ νμ΄ν”„λΌμΈ κ³„μ† μ§„ν–‰

3. **NULL κ°’ λ° λ°μ΄ν„° μ²λ¦¬**
   - ν…μ¤νΈ NULL κ°’ μΌκ΄€μ  μ²λ¦¬
   - μ λ‹μ½”λ“ μ •κ·ν™” λ° κ³µλ°± μ²λ¦¬
   - λ°μ΄ν„°ν”„λ μ„ κ²€μ¦ λ° λ³΄κ³ 

4. **ν™κ²½ νΈν™μ„±**
   - μλ„μ°/λ¦¬λ…μ¤ μλ™ κ°μ§€ λ° μµμ ν™”
   - κ° ν™κ²½μ— λ§λ” λ…λ Ήμ–΄ ν•μ‹ μ‚¬μ©
   - νμΌ κ²½λ΅ μ²λ¦¬ κ°•ν™”

5. **λ¨λ“ λ‹¨μ„μ μ„¤κ³„**
   - κ° λ¨λΈμ΄ λ…λ¦½μ μΌλ΅ μ‹¤ν–‰ κ°€λ¥
   - λ¨λΈ κ°„ μμ΅΄μ„± μµμ†ν™”
   - μ¤‘κ°„ κ²°κ³Όλ¬Όμ„ μ²΄ν¬ν¬μΈνΈλ΅ μ €μ¥

## π€ μ‹¤ν–‰ λ°©λ²•

### ν™κ²½ μ„¤μ •

```bash
# 1. κ°€μƒν™κ²½ μƒμ„± λ° ν™μ„±ν™”
python -m venv venv
source venv/bin/activate  # μλ„μ°: venv\Scripts\activate

# 2. μμ΅΄μ„± μ„¤μΉ
pip install -r requirements.txt

# 3. (μ„ νƒ) KenLM μ„¤μΉ - λ¦¬λ…μ¤ ν™κ²½ κ¶μ¥
pip install https://github.com/kpu/kenlm/archive/master.zip
# μλ„μ°λ” μ„¤μΉκ°€ λ³µμ΅ν•λ―€λ΅ μƒλµν•΄λ„ λ¨ (λ”λ―Έ νμΌ μλ™ μ²λ¦¬)
```

### μ „μ²΄ νμ΄ν”„λΌμΈ μ‹¤ν–‰

```bash
# μ „μ²΄ νμ΄ν”„λΌμΈ ν• λ²μ— μ‹¤ν–‰
bash run.sh  # μλ„μ°: κ° νμ΄μ¬ μ¤ν¬λ¦½νΈλ¥Ό μμ„λ€λ΅ μ‹¤ν–‰

# λλ” λ‹¨κ³„λ³„ μ‹¤ν–‰
python src/0_split_folds.py  # λ°μ΄ν„° λ¶„ν• 
python src/1_tfidf_lgbm.py   # TF-IDF + LightGBM ν•™μµ
python src/2_build_lm.py     # KenLM κµ¬μ¶•
python src/train_lora.py     # Mistral ν•™μµ
python src/train_deberta.py  # DeBERTa ν•™μµ
python src/stack.py          # λ©”νƒ€λ¨λΈ ν•™μµ
python src/infer.py          # μµμΆ… μ¶”λ΅  λ° κ²°κ³Ό μƒμ„±
```

### κ°λ³„ λ‹¨κ³„ μ‹¤ν–‰ λ° νλΌλ―Έν„° μ΅°μ •

```bash
# μ»¤λ§¨λ“λΌμΈ μΈμλ΅ νλΌλ―Έν„° μ „λ‹¬
python src/train_lora.py --epochs 5 --batch_size 32

# ν™κ²½λ³€μλ΅ νλΌλ―Έν„° μ „λ‹¬
set EPOCHS=5
set BATCH_SIZE=32
python src/train_lora.py

# Hugging Face ν† ν° μ„¤μ • (ν•„μ” μ‹)
set HUGGINGFACE_TOKEN=your_token
python src/train_lora.py
```

## π”„ νμ΄ν”„λΌμΈ λ™μ‘ μ›λ¦¬

1. **λ°μ΄ν„° λ¶„ν• (0_split_folds.py)**
   - train.csv β†’ train_folds.csv λ³€ν™
   - ν•™μµ/κ²€μ¦ λ°μ΄ν„° μ¤€λΉ„

2. **νΉμ§• μ¶”μ¶ λ¨λΈ ν•™μµ**
   - **TF-IDF + LightGBM(1_tfidf_lgbm.py)**: λ‹¨μ–΄ λΉλ„ κΈ°λ° νΉμ§• μ¶”μ¶
   - **KenLM(2_build_lm.py)**: n-gram κΈ°λ° μ–Έμ–΄ λ¨λΈ κµ¬μ¶•

3. **λ”¥λ¬λ‹ λ¨λΈ ν•™μµ**
   - **Mistral-7B(train_lora.py)**: λ€κ·λ¨ μ–Έμ–΄ λ¨λΈ νμΈνλ‹
   - **DeBERTa(train_deberta.py)**: μ–‘λ°©ν–¥ μΈμ½”λ” λ¨λΈ νμΈνλ‹

4. **μ•™μƒλΈ” λ¨λΈ ν•™μµ(stack.py)**
   - λ¨λ“  λ¨λΈμ μμΈ΅ κ²°κ³Ό μμ§‘
   - λ΅μ§€μ¤ν‹± νκ·€λ΅ μµμ  μ΅°ν•© ν•™μµ

5. **μµμΆ… μ¶”λ΅ (infer.py)**
   - ν…μ¤νΈ λ°μ΄ν„°μ— λ¨λ“  λ¨λΈ μ μ©
   - λ©”νƒ€λ¨λΈλ΅ μµμΆ… μμΈ΅ κ²°ν•©
   - submission.csv μƒμ„±

## π“ κ²°κ³Ό λ° μ„±λ¥

- **μ‹¤ν–‰ μ‹κ°„ (A600 GPU κΈ°μ¤€)**
  | λ‹¨κ³„ | μ†μ” μ‹κ°„ |
  |-----|----------|
  | TF-IDF + LGBM | μ•½ 3λ¶„ |
  | KenLM λΉλ“ | μ•½ 2λ¶„ |
  | Mistral-7B | μ•½ 50λ¶„ |
  | DeBERTa | μ•½ 25λ¶„ |
  | μ¤νƒν‚Ή & μ¶”λ΅  | μ•½ 5λ¶„ |
  | **μ΄ν•©** | **μ•½ 85λ¶„** |

- **κ° λ¨λΈ κ°λ³„ μ„±λ¥**
  - TF-IDF + LightGBM: μ•½ 95% μ •ν™•λ„
  - Mistral-7B QLoRA: μ•½ 97% μ •ν™•λ„
  - DeBERTa-v3-Large: μ•½ 96% μ •ν™•λ„
  - μ¤νƒν‚Ή μ•™μƒλΈ”: μ•½ 98% μ •ν™•λ„

## π› οΈ λ¬Έμ  ν•΄κ²° κ°€μ΄λ“

### μμ£Ό λ°μƒν•λ” μ¤λ¥μ™€ ν•΄κ²° λ°©λ²•

1. **KenLM λ¨λ“ κ΄€λ ¨ μ¤λ¥**
   - μ—λ¬ λ©”μ‹μ§€: `ModuleNotFoundError: No module named 'kenlm'`
   - ν•΄κ²° λ°©λ²•: λ¬΄μ‹ν•΄λ„ λ¨ (λ”λ―Έ νμΌ μλ™ μƒμ„±λμ–΄ μ§„ν–‰)
   - μ„¤μΉ μ›ν•λ©΄: `pip install https://github.com/kpu/kenlm/archive/master.zip`

2. **Hugging Face λ¨λΈ λ‹¤μ΄λ΅λ“ μ¤λ¥**
   - μ—λ¬ λ©”μ‹μ§€: `Repository Not Found` λλ” `Unauthorized`
   - ν•΄κ²° λ°©λ²•: `.env` νμΌμ— `HUGGINGFACE_TOKEN=your_token` μ¶”κ°€
   - λλ”: ν™κ²½λ³€μλ΅ `set HUGGINGFACE_TOKEN=your_token`

3. **CUDA λ©”λ¨λ¦¬ λ¶€μ΅±**
   - μ—λ¬ λ©”μ‹μ§€: `CUDA out of memory`
   - ν•΄κ²° λ°©λ²•: `config.yaml`μ—μ„ `batch_size` κ°μ†
   - λλ”: λ” μ‘μ€ λ¨λΈ μ‚¬μ© (config.yamlμ—μ„ model_id λ³€κ²½)

4. **λ¨λΈ νμΌ μ—†μ μ¤λ¥**
   - μ—λ¬ λ©”μ‹μ§€: `μ²΄ν¬ν¬μΈνΈ νμΌμ΄ μ—†μµλ‹λ‹¤`
   - μ›μΈ: μ΄μ „ λ‹¨κ³„ ν•™μµμ΄ μ‹¤ν–‰λμ§€ μ•μ
   - ν•΄κ²° λ°©λ²•: λ„λ½λ μ¤ν¬λ¦½νΈ μ‹¤ν–‰ (infer.pyλ” μλ™μΌλ΅ λ€μ²΄ λ΅μ§ μ‚¬μ©)

### μ„±λ¥ κ°μ„  λ°©λ²•

1. **λ°μ΄ν„° μ¦κ°• κ°•ν™”**
   - `config.yaml`μ `augment` μ„Ήμ… μ΅°μ •
   - `p_noise` μ¦κ°€: λ” λ§μ€ μƒν”μ— λ…Έμ΄μ¦ μ μ©
   - `mask_ratio`, `swapcase_ratio` μ΅°μ •: λ…Έμ΄μ¦ κ°•λ„ μ΅°μ 

2. **λ¨λΈ μ•™μƒλΈ” μ¶”κ°€**
   - μƒ λ¨λΈ μ¶”κ°€: `src/stack.py`μ— μƒ λ¨λΈ ν†µν•©
   - κ°€μ¤‘μΉ μ΅°μ •: νΉμ • λ¨λΈμ— κ°€μ¤‘μΉ λ¶€μ—¬

3. **ν•μ΄νΌνλΌλ―Έν„° μµμ ν™”**
   - `config.yaml`μ—μ„ κ° λ¨λΈμ ν•μ΄νΌνλΌλ―Έν„° μ΅°μ •
   - Optuna ν™μ„±ν™”: `optuna.enable: true`λ΅ μ„¤μ •

## π“ κ²°λ΅ 

μ΄ ν”„λ΅μ νΈλ” λ‹¤μ–‘ν• ν…μ¤νΈ λ¶„λ¥ κΈ°λ²•μ„ μ΅°ν•©ν•μ—¬ κ°€μ§ ν…μ¤νΈλ¥Ό ν¨κ³Όμ μΌλ΅ νƒμ§€ν•λ” νμ΄ν”„λΌμΈμ„ μ κ³µν•©λ‹λ‹¤. νΉν κ°•ν™”λ λ΅κΉ… μ‹μ¤ν…κ³Ό κ²¬κ³ ν• μμ™Έ μ²λ¦¬λ¥Ό ν†µν•΄ μ‹¤ν–‰ ν™κ²½μ— μƒκ΄€μ—†μ΄ μ•μ •μ μΌλ΅ μ‘λ™ν•λ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤. μμ΅΄μ„± λ¬Έμ (νΉν KenLM)κ°€ μμ–΄λ„ μ „μ²΄ νμ΄ν”„λΌμΈμ΄ μ¤‘λ‹¨λμ§€ μ•κ³  λ€μ²΄ λ΅μ§μΌλ΅ κ³„μ† μ§„ν–‰λ©λ‹λ‹¤.

μ‹¤ν–‰ μ‹κ°„κ³Ό μ„±λ¥ κ°„μ κ· ν•μ„ κ³ λ ¤ν•μ€μΌλ©°, μ•½ 2μ‹κ°„ μ΄λ‚΄μ— A600 GPU ν™κ²½μ—μ„ μ „μ²΄ νμ΄ν”„λΌμΈμ„ μ™„λ£ν•  μ μμµλ‹λ‹¤. κ° λ¨λ“μ€ λ…λ¦½μ μΌλ΅ μ‹¤ν–‰ κ°€λ¥ν•λ©°, νλΌλ―Έν„° μ΅°μ •μ„ ν†µν•΄ λ‹¤μ–‘ν• ν™κ²½κ³Ό μ”κµ¬μ‚¬ν•­μ— λ§κ² μ΅°μ •ν•  μ μμµλ‹λ‹¤.

## π“§ λ¬Έμ λ° κΈ°μ—¬

- μ½”λ“, μ‹¤ν—, μµμ… κ΄€λ ¨ λ¬Έμλ” μ–Έμ λ“  ν™μν•©λ‹λ‹¤!
- λ²„κ·Έ μ‹ κ³  λ° κ°μ„  μ μ•λ„ μ κ·Ή ν™μν•©λ‹λ‹¤.
